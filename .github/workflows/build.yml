name: Build

on:
  push:
    branches:
      - '*' # matches every branch that doesn't contain a '/'
      - '*/*' # matches every branch containing a single '/'
      - '**' # matches every branch
      - '!master' # excludes master
      - '!main' # excludes main
      - '!release' # excludes release
      - '!release/*' # excludes release

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20.x'
      - name: Find and Replace
        uses: jacobtomlinson/gha-find-replace@master
        with:
          find: 'UA-XXXXXXXXX-1'
          replace: ${{ secrets.G_TAG_CODE }}
          include: 'vite.config.ts' # Replace google Tag
      - run: npm config set legacy-peer-deps true
      - name: Deploy Website to angular-buch-website-build.git (gh-pages branch)
        env:
          GH_TOKEN: ${{ secrets.ACCESS_TOKEN }}
          GITHUB_REPO: https://github.com/d-koppenhagen/k9n.dev.git
          GITHUB_NAME: Danny Koppenhagen
          GITHUB_EMAIL: mail@k9n.dev
        run: |
          npx angular-cli-ghpages --cname=k9n.dev --no-silent --dir=dist/analog/public --repo="$GITHUB_REPO" --name="$GITHUB_NAME" --email="$GITHUB_EMAIL" --dry-run
